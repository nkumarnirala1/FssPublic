<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facade Structural Services</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
<!-- Fixed Header -->
<header class="fixed-header">
    <div class="header-left">
        <img src="/images/fsslogo.jpeg" alt="FSS Logo" class="logo">
        <span class="header-title">Facade Structural Services</span>
    </div>
    <div class="header-right">
        <form th:action="@{/estimation}" method="get">
            <button type="submit" class="header-btn estimation-btn">Estimation</button>
        </form>
        <form th:action="@{/download-pdf}" method="get">
            <button type="submit" class="header-btn download-btn">Download PDF</button>
        </form>
        <form th:action="@{/logout}" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <button type="submit" class="header-btn logout-btn">⏻ Logout</button>
        </form>
    </div>
</header>

<!-- Main Layout with Independent Scrolling -->
<div class="layout-container">
    <!-- Left Sidebar - Independent Scrolling -->
    <aside class="sidebar left-sidebar">
        <div class="sidebar-content">
            <nav class="sidebar-nav">
                <button class="sidebar-btn window-btn" onclick="toggleDropdown('window-dropdown')">
                    Window
                </button>
                <div id="window-dropdown" class="dropdown-menu hidden">
                    <button onclick="showWindowFlow('sliding')">Sliding Form</button>
                    <button onclick="showWindowFlow('casement')">Casement Form</button>
                </div>
                <button class="sidebar-btn" onclick="showForm('semi-unitized')">Semi-Unitized</button>
                <button class="sidebar-btn" onclick="showForm('fully-unitized')">Fully-Unitized</button>
            </nav>
        </div>
    </aside>

    <!-- Main Content Area - Independent Scrolling -->
    <main class="main-content">
        <div class="content-wrapper" id="main-content">
            <!-- Window Flow Content -->
            <div id="window-flow-content" class="flow-content hidden">
                <div id="sliding-flow" class="hidden">
                    <h2>Sliding Window Forms</h2>
                    <div class="flow-buttons">
                        <button onclick="showFlowStep('sliding', 'combined')">A. Combined Form → Central Meeting → Outer</button>
                        <button onclick="showFlowStep('sliding', 'ab')">B. A+B Form → Central Meeting → Outer</button>
                    </div>
                    <div id="sliding-flow-steps"></div>
                </div>

                <div id="casement-flow" class="hidden">
                    <h2>Casement Window Forms</h2>
                    <div class="flow-buttons">
                        <button onclick="showFlowStep('casement', 'combined')">A. Combined Form → Central Meeting → Outer</button>
                        <button onclick="showFlowStep('casement', 'ab')">B. A+B Form → Central Meeting → Outer</button>
                    </div>
                    <div id="casement-flow-steps"></div>
                </div>
            </div>

            <!-- Semi Unitized Form -->
            <div id="semi-form" class="form-section hidden">
                <h2>Semi Unitized Glazing Load Input</h2>
                <form th:action="@{/calculate}" method="post" th:object="${input}" class="glazing-form">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

                    <label for="typeOfGlazing">Type of Glazing</label>
                    <select id="typeOfGlazing" th:field="*{typeOfGlazing}" required>
                        <option value="" disabled selected>Select Glazing Type</option>
                        <option value="SLIDING WINDOW">SLIDING WINDOW</option>
                        <option value="IN TO IN SEMI UNITIZED">IN TO IN SEMI UNITIZED</option>
                        <option value="SINGLE BRACKET SEMI UNITIZED">SINGLE BRACKET SEMI UNITIZED</option>
                        <option value="DOUBLE BRACKET SEMI UNITIZED">DOUBLE BRACKET SEMI UNITIZED</option>
                    </select>

                    <label for="unsupportedLength">Unsupported Length (mm)</label>
                    <input type="number" id="unsupportedLength" name="unsupportedLength" th:value="*{unsupportedLength}" placeholder="Enter length in mm" required/>

                    <label for="gridLength">Grid Length (mm)</label>
                    <input type="number" id="gridLength" name="gridLength" th:value="*{gridLength}" placeholder="Enter length in mm" required/>

                    <label for="windPressure">Wind Pressure (kN/m²)</label>
                    <input type="number" id="windPressure" name="windPressure" th:value="*{windPressure}" step="0.01" placeholder="Enter pressure" required/>

                    <label for="stackBracket">Stack Bracket (mm)</label>
                    <input type="number" id="stackBracket" name="stackBracket" th:value="*{stackBracket}" placeholder="Enter bracket size" required/>

                    <button type="submit">Calculate</button>
                </form>
            </div>

            <!-- Fully Unitized Form -->
            <div id="fully-form" class="form-section hidden">
                <h2>Fully Unitized Glazing Load Input</h2>
                <form th:action="@{/calculateFully}" method="post" th:object="${input}" class="glazing-form">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

                    <label for="fullyTypeOfGlazing">Unitized Type</label>
                    <select id="fullyTypeOfGlazing" name="typeOfGlazing" required>
                        <option value="" disabled selected>Select Unitized Type</option>
                        <option value="UNITIZED SYSTEM">UNITIZED SYSTEM</option>
                        <option value="UNITIZED WITH FIN">UNITIZED WITH FIN</option>
                    </select>

                    <label for="fullyUnsupportedLength">Unsupported Length (mm)</label>
                    <input type="number" id="fullyUnsupportedLength" name="unsupportedLength" th:value="*{unsupportedLength}" placeholder="Enter length in mm" required/>

                    <label for="fullyGridLength">Grid Length (mm)</label>
                    <input type="number" id="fullyGridLength" name="gridLength" th:value="*{gridLength}" placeholder="Enter length in mm" required/>

                    <label for="fullyWindPressure">Wind Pressure (kN/m²)</label>
                    <input type="number" id="fullyWindPressure" name="windPressure" th:value="*{windPressure}" step="0.01" placeholder="Enter pressure" required/>

                    <button type="submit">Calculate</button>
                </form>
            </div>

            <!-- Default Placeholder -->
            <div id="default-content" class="placeholder-form">
                Please select a form from the left sidebar to begin.
            </div>
        </div>
    </main>

    <!-- Right Sidebar - Independent Scrolling -->
    <aside class="sidebar right-sidebar" id="history-sidebar">
        <div class="sidebar-content">
            <h3>Calculation Results</h3>

            <!-- Results Panel -->
            <div th:if="${Ixx != null}" class="result-container">
                <h4>Calculated Results</h4>
                <div class="result-item">
                    <span class="label">Required Ixx:</span>
                    <span class="value" th:text="${Ixx} + ' ×10¹⁰ mm⁴'"></span>
                </div>
                <div class="result-item">
                    <span class="label">Allowable deflection:</span>
                    <span class="value" th:text="${df} + ' mm'"></span>
                </div>
                <div class="result-item">
                    <span class="label">Bending Moment:</span>
                    <span class="value" th:text="${bm} + ' kN·m'"></span>
                </div>

                <!-- Custom Deflection Form -->
                <form th:action="@{/calculate-deflection}" method="post" class="deflection-form">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <label for="userIxx">Enter Custom Ixx (×10¹⁰ mm⁴):</label>
                    <input type="number" id="userIxx" name="userIxx" step="0.01" th:value="*{userIxx}" required/>
                    <button type="submit">Calculate Deflection</button>
                </form>

                <div th:if="${cf != null}" class="result-container-deflection">
                    <div class="result-item">
                        <span class="label">Calculated Deflection:</span>
                        <span class="value" th:text="${cf} + ' mm'"></span>
                    </div>
                </div>

                <!-- Profile Check Buttons -->
                <div class="profile-buttons">
                    <form th:action="@{/checkMullion}" method="post">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                        <button type="submit" class="profile-btn mullion-btn">Check Mullion Profile</button>
                    </form>

                    <form th:action="@{/checkTransom}" method="post">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                        <button type="submit" class="profile-btn transom-btn">Check Transom Profile</button>
                    </form>
                </div>
            </div>

            <!-- Error Display -->
            <div th:if="${error}" class="error-container">
                <img class="error-icon" src="/images/error_img.png" alt="Error Icon">
                <p th:text="${error}"></p>
            </div>

            <!-- Input History -->
            <div class="history-section">
                <h4>Input History</h4>
                <ul class="history-list">
                    <li th:if="${input?.typeOfGlazing}">
                        <strong>Glazing Type:</strong> <span th:text="${input.typeOfGlazing}"></span>
                    </li>
                    <li th:if="${input?.unsupportedLength}">
                        <strong>Unsupported Length:</strong> <span th:text="${input.unsupportedLength} + ' mm'"></span>
                    </li>
                    <li th:if="${input?.gridLength}">
                        <strong>Grid Length:</strong> <span th:text="${input.gridLength} + ' mm'"></span>
                    </li>
                    <li th:if="${input?.windPressure}">
                        <strong>Wind Pressure:</strong> <span th:text="${input.windPressure} + ' kN/m²'"></span>
                    </li>
                    <li th:if="${input?.stackBracket}">
                        <strong>Stack Bracket:</strong> <span th:text="${input.stackBracket} + ' mm'"></span>
                    </li>
                </ul>
            </div>
        </div>
    </aside>
</div>

<!-- JavaScript -->
<script>
    // Toggle Window dropdown
    function toggleDropdown(menuId) {
        const dropdown = document.getElementById(menuId);
        dropdown.classList.toggle('hidden');
    }

    // Show window flow content
    function showWindowFlow(type) {
        hideAllContent();
        document.getElementById('window-dropdown').classList.add('hidden');
        document.getElementById('window-flow-content').classList.remove('hidden');

        if (type === 'sliding') {
            document.getElementById('sliding-flow').classList.remove('hidden');
            document.getElementById('casement-flow').classList.add('hidden');
        } else {
            document.getElementById('casement-flow').classList.remove('hidden');
            document.getElementById('sliding-flow').classList.add('hidden');
        }
    }

    // Show flow steps
    function showFlowStep(windowType, flowType) {
        const stepsContainer = document.getElementById(windowType + '-flow-steps');
        let content = '';

        if (flowType === 'combined') {
            content = `
                    <div class="flow-step">
                        <h4>Step 1: Combined Form</h4>
                        <p>Configure combined form parameters...</p>
                        <form class="flow-form">
                            <input type="text" placeholder="Parameter 1" required>
                            <input type="text" placeholder="Parameter 2" required>
                            <button type="button" onclick="nextFlowStep('${windowType}', 'central')">Next: Central Meeting</button>
                        </form>
                    </div>
                `;
        } else {
            content = `
                    <div class="flow-step">
                        <h4>Step 1: A+B Form</h4>
                        <p>Configure A+B form parameters...</p>
                        <form class="flow-form">
                            <input type="text" placeholder="Parameter A" required>
                            <input type="text" placeholder="Parameter B" required>
                            <button type="button" onclick="nextFlowStep('${windowType}', 'central')">Next: Central Meeting</button>
                        </form>
                    </div>
                `;
        }
        stepsContainer.innerHTML = content;
    }

    // Navigate to next flow step
    function nextFlowStep(windowType, step) {
        const stepsContainer = document.getElementById(windowType + '-flow-steps');
        let content = '';

        if (step === 'central') {
            content = `
                    <div class="flow-step">
                        <h4>Step 2: Central Meeting</h4>
                        <p>Configure central meeting parameters...</p>
                        <form class="flow-form">
                            <input type="text" placeholder="Central Parameter 1" required>
                            <input type="text" placeholder="Central Parameter 2" required>
                            <button type="button" onclick="nextFlowStep('${windowType}', 'outer')">Next: Outer</button>
                        </form>
                    </div>
                `;
        } else if (step === 'outer') {
            content = `
                    <div class="flow-step">
                        <h4>Step 3: Outer Configuration</h4>
                        <p>Final outer configuration...</p>
                        <form class="flow-form">
                            <input type="text" placeholder="Outer Parameter 1" required>
                            <input type="text" placeholder="Outer Parameter 2" required>
                            <button type="submit">Complete Flow</button>
                        </form>
                    </div>
                `;
        }
        stepsContainer.innerHTML = content;
        updateHistory(`${windowType} - ${step} step configured`);
    }

    // Show main forms (Semi/Fully Unitized)
    function showForm(type) {
        hideAllContent();

        if (type === 'semi-unitized') {
            document.getElementById('semi-form').classList.remove('hidden');
        } else if (type === 'fully-unitized') {
            document.getElementById('fully-form').classList.remove('hidden');
        }
    }

    // Hide all content sections
    function hideAllContent() {
        document.getElementById('default-content').classList.add('hidden');
        document.getElementById('window-flow-content').classList.add('hidden');
        document.getElementById('semi-form').classList.add('hidden');
        document.getElementById('fully-form').classList.add('hidden');
        document.getElementById('sliding-flow').classList.add('hidden');
        document.getElementById('casement-flow').classList.add('hidden');
    }

    // Update history (placeholder function)
    function updateHistory(action) {
        // This would typically update the right sidebar history
        console.log('History updated:', action);
    }

    // Initialize page
    window.onload = function() {
        // Check if there are existing results to show a form
        const hasResults = document.querySelector('[th\\:if="${Ixx != null}"]');
        if (!hasResults) {
            document.getElementById('default-content').classList.remove('hidden');
        } else {
            // If there are results, show the appropriate form based on the last calculation
            showForm('semi-unitized'); // Default to semi-unitized if results exist
        }
    };
</script>
</body>
</html>