<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facade Structural Services - Mullion Check</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/mullion-style.css}">
</head>
<body>
<!-- Fixed Header -->
<header class="fixed-header">
    <div class="header-left">
        <img src="/images/fsslogo.jpeg" alt="FSS Logo" class="logo">
        <h1>Facade Structural Services</h1>
    </div>
    <div class="header-right">
        <form th:action="@{/estimation}" method="get">
            <button type="submit" class="header-btn estimation-btn">Estimation</button>
        </form>
        <form th:action="@{/download-pdf}" method="get">
            <button type="submit" class="header-btn download-btn">Download PDF</button>
        </form>
        <form th:action="@{/logout}" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <button type="submit" class="header-btn logout-btn">⏻Logout</button>
        </form>
    </div>
</header>

<!-- Main Content Wrapper -->
<div class="main-wrapper">
    <!-- Left Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-buttons">
            <button class="tab-btn" id="semi-tab" onclick="location.href='@{/calculate}'">
                Semi Unitized
            </button>
            <button class="tab-btn" id="fully-tab" onclick="location.href='@{/calculateFully}'">
                Fully Unitized
            </button>
        </div>

        <!-- Input Values Table -->
        <div class="sidebar-results" th:if="${Ixx != null}">
            <h3>Current Input Values</h3>
            <table class="values-table">
                <tr>
                    <td>Required Ixx:</td>
                    <td th:text="${Ixx} + ' ×10¹⁰ mm⁴'"></td>
                </tr>
                <tr>
                    <td>Allowable deflection:</td>
                    <td th:text="${df} + ' mm'"></td>
                </tr>
                <tr>
                    <td>Bending Moment:</td>
                    <td th:text="${bm} + ' kN·m'"></td>
                </tr>
            </table>
        </div>
    </aside>

    <!-- Main Content Area -->
    <main class="content-area">
        <div class="content-container-mullion">
            <!-- Back Button -->
            <div class="navigation-buttons">
                <form th:action="@{/calculate}" method="get">
                    <button type="submit" class="back-btn">← Back to Calculation</button>
                </form>
            </div>

            <!-- Mullion Profile Check Form -->
            <div class="mullion-form-container">
                <h2>Mullion Profile Check</h2>

                <form th:action="@{/submitMullionProfile}" method="post" class="profile-form">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

                    <label for="userIxx">User Ixx (×10¹⁰ mm⁴)</label>
                    <input type="number" step="0.01" id="userIxx" name="userIxx"
                           th:value="${mullionInput != null} ? ${mullionInput.userIxx} : ${userIxx}" required/>

                    <label for="glassThickness">Glass Thickness (mm)</label>
                    <input type="number" step="0.01" id="glassThickness" name="glassThickness"
                           th:value="${mullionInput != null} ? ${mullionInput.glassThickness} : ${glassThickness}" required/>

                    <label for="crossSectionalArea">Cross Sectional Area (cm²)</label>
                    <input type="number" step="0.01" id="crossSectionalArea" name="crossSectionalArea"
                           th:value="${mullionInput != null} ? ${mullionInput.crossSectionalArea} : ${crossSectionalArea}" required/>

                    <label for="transomToTransomDistance">Transom to Transom Distance (mm)</label>
                    <input type="number" step="0.01" id="transomToTransomDistance" name="transomToTransomDistance"
                           th:value="${mullionInput != null} ? ${mullionInput.transomToTransomDistance} : ${transomToTransomDistance}" required/>

                    <label for="b">Width b (mm)</label>
                    <input type="number" step="0.01" id="b" name="b"
                           th:value="${mullionInput != null} ? ${mullionInput.b} : ${b}" required/>

                    <label for="a">Height a (mm)</label>
                    <input type="number" step="0.01" id="a" name="a"
                           th:value="${mullionInput != null} ? ${mullionInput.a} : ${a}" required/>

                    <label for="t2">t₂ (mm)</label>
                    <input type="number" step="0.01" id="t2" name="t2"
                           th:value="${mullionInput != null} ? ${mullionInput.t2} : ${t2}" required/>

                    <label for="t1">t₁ (mm)</label>
                    <input type="number" step="0.01" id="t1" name="t1"
                           th:value="${mullionInput != null} ? ${mullionInput.t1} : ${t1}" required/>

                    <label for="iyy">Iyy (cm⁴)</label>
                    <input type="number" step="0.01" id="iyy" name="iyy"
                           th:value="${mullionInput != null} ? ${mullionInput.iyy} : ${iyy}" required/>

                    <label for="boundingboxy">Bounding Box Y (mm)</label>
                    <input type="number" step="0.01" id="boundingboxy" name="boundingboxy"
                           th:value="${mullionInput != null} ? ${mullionInput.boundingboxy} : ${boundingboxy}" required/>

                    <button type="submit">Submit Mullion Profile</button>
                </form>
            </div>

            <!-- Mullion Results -->
            <div class="result-wrapper" th:if="${bendingStress != null or shearStress != null}">
                <div class="result-container">
                    <h2>Mullion Profile Results</h2>

                    <!-- Bending Stress Result -->
                    <p th:if="${bendingStress}" style="color: green; font-weight: bold;">
                        ✅ Profile is safe under combined axial and bending stress
                    </p>
                    <p th:if="${bendingStress == false}" style="color: red; font-weight: bold;">
                        ❌ Profile is unsafe under combined axial and bending stress
                    </p>

                    <!-- Shear Stress Result -->
                    <p th:if="${shearStress}" style="color: green; font-weight: bold;">
                        ✅ Profile is safe under shear stress
                    </p>
                    <p th:if="${shearStress == false}" style="color: red; font-weight: bold;">
                        ❌ Profile is unsafe under shear stress
                    </p>
                </div>
            </div>

            <!-- Navigation to Transom Check -->
            <div class="navigation-buttons" th:unless="${bendingStress == null and shearStress == null}">
                <form th:action="@{/checkTransom}" method="post">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <button type="submit" class="next-btn">Check Transom Profile →</button>
                </form>
            </div>

            <!-- Error Box -->
            <div class="result-wrapper" th:if="${error}">
                <div class="error-box">
                    <img class="error-icon" src="/images/error_img.png" alt="Error Icon">
                    <p th:text="${error}"></p>
                </div>
            </div>
        </div>
    </main>
</div>
</body>
</html>