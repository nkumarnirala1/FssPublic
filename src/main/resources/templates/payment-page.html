<!-- payment.html -->
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NextGen Facade — Payment</title>
    <link rel="stylesheet" href="/static/css/payments.css">
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <style>
        /* Fixed header */
        header.header {
          position: fixed;
          top: 0; left: 0; right: 0;
          background: var(--bg-elevated);
          backdrop-filter: blur(10px);
          border-bottom: 1px solid var(--border-primary);
          z-index: 100;
        }
        header .container {
          max-width: var(--container-xl);
          margin: 0 auto;
          display: flex;
          align-items: center;
          justify-content: space-between;
          padding: var(--space-16) var(--space-20);
        }
        .brand {
          display: flex;
          align-items: center;
          gap: var(--space-12);
        }
        .brand-icon {
          width: 32px;
          height: 32px;
          background: linear-gradient(135deg, var(--brand-teal), var(--brand-teal-light));
          border-radius: var(--radius-lg);
        }
        .brand-text {
          font-family: var(--font-family-base);
          font-size: var(--font-size-2xl);
          font-weight: var(--font-weight-bold);
          color: var(--text-primary);
        }
        .header-actions {
          display: flex;
          align-items: center;
          gap: var(--space-16);
        }
        .security-badge {
          display: flex;
          align-items: center;
          gap: var(--space-8);
          background: var(--bg-hover);
          border: 1px solid var(--border-secondary);
          border-radius: var(--radius-full);
          padding: var(--space-8) var(--space-16);
          font-size: var(--font-size-sm);
          color: var(--text-secondary);
        }
        .nav-buttons {
          display: flex;
          gap: var(--space-8);
        }
        .nav-buttons .btn {
          display: flex;
          align-items: center;
          gap: var(--space-6);
          padding: var(--space-8) var(--space-12);
          font-size: var(--font-size-sm);
          font-weight: var(--font-weight-medium);
          border-radius: var(--radius-base);
          text-decoration: none;
          color: var(--text-primary);
          background: transparent;
          border: 1px solid var(--border-primary);
          transition: background var(--duration-fast);
        }
        .nav-buttons .btn--secondary {
          background: var(--brand-teal);
          color: var(--color-btn-primary-text);
          border: none;
        }
        .nav-buttons .btn:hover {
          background: var(--bg-hover);
        }
        body {
          padding-top: calc(var(--space-16)*2 + var(--font-size-2xl));
        }
    </style>
</head>
<body>
<header class="header">
    <div class="container">
        <div class="brand">
            <div class="brand-icon"></div>
            <div class="brand-text">NextGen Facade</div>
        </div>
        <div class="header-actions">
            <div class="security-badge">
                <svg width="16" height="16" fill="#12DAD1" viewBox="0 0 24 24">
                    <path d="M12 2L3 7l9 13 9-13-9-5zM12 7c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2z"/>
                </svg>
                <span>Secure Payments • Razorpay Certified</span>
            </div>
            <div class="nav-buttons">
                <a href="/" class="btn btn--outline">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                    </svg>
                    Home
                </a>
                <a href="/logout" class="btn btn--secondary">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.59L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
                    </svg>
                    Logout
                </a>
            </div>
        </div>
    </div>
</header>

<div class="payment-container">
    <h2>Complete Your Payment</h2>
    <div class="info-row">
        <span><strong>Plan:</strong></span>
        <span th:text="${plan.planname}"></span>
    </div>
    <div class="info-row">
        <span><strong>Base Rate:</strong></span>
        <span>₹<span th:text="${plan.price}"></span></span>
    </div>
    <div class="info-row">
        <span><strong>Final Amount:</strong></span>
        <span>₹<span th:text="${totalAmount}"></span></span>
    </div>
    <button id="rzp-button"
            th:data-key="${order.key}"
            th:data-amount="${order.amount}"
            th:data-currency="${order.currency}"
            th:data-orderid="${order.id}"
            th:data-planname="${plan.planname}">
        Pay Now
    </button>
</div>

<script>
    const btn = document.getElementById('rzp-button');
    btn.onclick = e => {
      e.preventDefault();
      const options = {
        key: btn.dataset.key,
        amount: btn.dataset.amount,
        currency: btn.dataset.currency,
        name: "NextGen Facade",
        description: "Subscription Payment for " + btn.dataset.planname,
        order_id: btn.dataset.orderid,
        handler: resp => window.location.href = `/payment/success?paymentId=${resp.razorpay_payment_id}&orderId=${resp.razorpay_order_id}`,
        prefill: { name:"",email:"",contact:"" },
        theme: { color:"#12DAD1" }
      };
      new Razorpay(options).open();
    };
</script>
</body>
</html>